<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>Scientific Programming Guidelines</title>

    <link rel="stylesheet" href="dist/reset.css">
    <link rel="stylesheet" href="dist/reveal.css">
    <link rel="stylesheet" href="dist/theme/solarized.css" id="theme">
    <!-- Theme used for syntax highlighted code -->
    <link rel="stylesheet" href="plugin/highlight/zenburn.css" id="highlight-theme">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="dist/custom.css">
  </head>
  <body>
    <div class="reveal">
      <div class="slides">
        <section data-background-image="assets/img/ru_logo_a4_imm_eng_1.png"
                 data-background-size="25%"
                 data-background-position="bottom right 10%">
          <h2>Scientific Programming Best Practices</h2>
          <p style="margin-top: 10%;">Tom Westerhout<br>
            <span style="font-size: 80%;">2 February 2021</span></p>
        </section>

        <section data-background-image="assets/img/ru_logo_a4_imm_eng_1.png"
                 data-background-size="25%"
                 data-background-position="bottom right 10%">
          <h2>Contents</h2>

          <ul>
            <li>Reproducibility;<br>
              <span class="fragment">
                &rarr; keep track of your files<br></span>
              <span class="fragment">
                &nbsp; &nbsp; &rarr; <span class="concept">Version Control Systems (VCS)</span></span>
            </li>
            <li>Correctness;</li>
            <li style="color: #93a1a1;">Performance &mdash; some other time.</li>
          </ul>
        </section>

        <section data-background-image="assets/img/ru_logo_a4_imm_eng_1.png"
                 data-background-size="25%"
                 data-background-position="bottom right 10%">
          <h2>What is version control?</h2>

          <div style="width: 70%; margin-left: auto; margin-right: auto;">
            <blockquote style="width: 100%">
              Version control is a system that records changes to a file or set
              of files over time so that you can recall specific versions later.
            </blockquote>
            <p style="font-size: 50%; text-align: right;">
              <span style="font-style: italic">Source:</span>
              <a href=https://git-scm.com/book/en/v2>Pro Git Book</a>
            </p>
          </div>

          <div class="fragment"
               style="width: 100%; margin-top: 5%; margin-left: auto; margin-right: auto;">
            <p style="text-align: left;">Example:</p>
            <pre style="font-size: 80%; width: 100%;"><code data-trim data-noescape class="shell">
              $ ls
              main_fixed_eq5.tex  main_prb.tex  main_prl_final.tex
              main_prl.tex        main.tex      main_v2.tex
              $ # Thinking...
              $ cp main_prb.tex main_prb_final.tex
            </code></pre>
          </div>
        </section>

        <section data-background-image="assets/img/ru_logo_a4_imm_eng_1.png"
                 data-background-size="25%"
                 data-background-position="bottom right 10%">
          <h2>Local version control systems</h2>

          <div class="r-hstack">
            <div class="fragment" style="text-align: left; margin-right: 5%;">
              <ul class="checklist" >
                <li class="fail">How to collaborate?</li>
                <li class="fail">Files are all in one place!</li>
              </ul>
            </div>
            <img src="assets/img/local_version_control.png" style="margin: 0; width: 50%;">
          </div>
        </section>

        <section data-background-image="assets/img/ru_logo_a4_imm_eng_1.png"
                 data-background-size="25%"
                 data-background-position="bottom right 10%">
          <h2>Centralized version control systems</h2>

          <div class="r-hstack">
            <div class="fragment" style="text-align: left; margin-right: 2%;">
              <ul class="checklist">
                <li class="pass">How to collaborate?</li>
                <li class="fail">Files are all in one place!</li>
              </ul>
            </div>
            <img src="assets/img/centralized_version_control.png" style="margin: 0; width: 60%;">
          </div>
        </section>

        <section data-background-image="assets/img/ru_logo_a4_imm_eng_1.png"
                 data-background-size="25%"
                 data-background-position="bottom right 10%">
          <h2 style="margin-bottom: 0;">Distributed version control systems</h2>

          <div class="r-hstack">
            <div class="fragment" style="text-align: left; margin-right: 5%;">
              <ul class="checklist">
                <li class="pass">How to collaborate?</li>
                <li class="pass">Files are all in one place!</li>
              </ul>
              <p class="fragment" style="margin-top: 10%; text-align: center; font-size: 200%; font-weight: bold;">
                Git</p>
            </div>
            <img src="assets/img/distributed_version_control.png" style="margin: 0; width: 42%;">
          </div>
        </section>

        <section data-background-image="assets/img/ru_logo_a4_imm_eng_1.png"
                 data-background-size="25%"
                 data-background-position="bottom right 10%">
          <h2>Git</h2>

          <div style="width: 70%; margin-left: auto; margin-right: auto;">
            <blockquote style="width: 100%;">
              Of the professional developers who responded to the survey,
              almost <span style="font-weight: bold;">82%</span> use GitHub as a
              collaborative tool
            </blockquote>
            <p style="font-size: 50%; margin-top: 0; text-align: right;">
              <span style="font-style: italic">Source:</span>
              <a href=https://insights.stackoverflow.com/survey/2020#technology-collaboration-tools>
                Stack Overflow Developer Survey 2020</a>
            </p>
          </div>

          <ul class="fragment">
            <li>Concepts</li>
            <li>Example &amp; some commands</li>
          </ul>
        </section>

        <section data-background-image="assets/img/ru_logo_a4_imm_eng_1.png"
                 data-background-size="25%"
                 data-background-position="bottom right 10%">
          <h2 style="margin-bottom: 7%;">Repository (or Git project)</h2>

          <code style="font-weight: bold; font-size: 150%;">
            repository = files + history</code>

          <div class="r-hstack fragment" style="margin-top: 5%;">
            <p style="margin-top: 2%; margin-bottom: auto; margin-left: 5%; margin-right: 0;">
              Files:</p>
            <pre style="font-size: 60%; margin-left: 4%; width: 45%;"><code data-trim data-noescape class="shell">
              quantum_skyrmions/
              ├── Analysis
              │   ├── 19_site_cluster.yml
              │   ├── 7_site_cluster.yml
              │   ├── slurm_main.sh
              │   └── SpinED-x86_64.AppImage
              ├── Drafts
              │   ├── paper.tex
              │   └── references.bib
              ├── Figures
              │   ├── ground_state_energy.pdf
              │   └── topological_invariant.pdf
              ├── Proofs
              ├── Published
              ├── Raw data
              │   ├── exact_diagonalization_result_19.h5
              │   └── exact_diagonalization_result_7.h5
              └── Submitted
            </code></pre>
            <p style="margin-top: auto; margin-bottom: auto; margin-left: 4%;">
              i.e. your whole project folder</p>
          </div>
        </section>

        <section data-background-image="assets/img/ru_logo_a4_imm_eng_1.png"
                 data-background-size="25%"
                 data-background-position="bottom right 10%">
          <h2>History</h2>

          <div style="width: 70%; margin-left: auto; margin-right: auto;">
            <blockquote style="width: 100%;">
              The file history appears as snapshots in time called <span class="concept">commits</span>
            </blockquote>
            <p style="font-size: 55%; margin-top: 0; text-align: right;">
              <span style="font-style: italic">Source:</span>
              <a href=https://guides.github.com/introduction/git-handbook/>Git Handbook</a>
            </p>
          </div>

          <ul>
            <li class="fragment">Commits are described by <span class="concept">hashes</span> (SHA),<br>
              e.g. <code>9d33835a8e744c5f9cc950f672885dd706c0852f</code></li>
            <li class="fragment">Hash function is any function that can be used
              to map data of arbitrary size to fixed-size values
              <span style="font-size: 55%;">(<span style="font-style: italic;">Source:</span>
                <a href="https://en.wikipedia.org/wiki/Hash_function">Wikipedia</a>)</span></li>
            <li class="fragment">Commits are assembled into linked lists:
                <img src="assets/img/linked_list_1.png" style="text-align: center; width: 80%;">
            </li>
          </ul>
        </section>

        <section data-background-image="assets/img/ru_logo_a4_imm_eng_1.png"
                 data-background-size="25%"
                 data-background-position="bottom right 10%">
          <h2>History</h2>
          <img src="assets/img/linked_list_2.png" style="text-align: center; width: 100%;">
        </section>

        <section data-background-image="assets/img/ru_logo_a4_imm_eng_1.png"
                 data-background-size="25%"
                 data-background-position="bottom right 10%">
          <h2>Git</h2>

          <ul>
            <li>Concepts (repository, commit, hash, branch)<br>
                <p class="concept" style="text-align: center;">Questions?</p>
            </li>
            <li class="fragment">Examples &amp; commands</li>
          </ul>
        </section>

        <section data-background-image="assets/img/ru_logo_a4_imm_eng_1.png"
                 data-background-size="25%"
                 data-background-position="bottom right 10%">
          <h2 style="margin-top: 0; margin-bottom: 0;">Example: creating a repository</h2>

          <div class="r-stack">
            <ul style="margin-top: 10px; margin-left: 10%;">
              <li>Choose a server: <a href="https://github.com/">GitHub</a>,
                <a href="https://about.gitlab.com/">GitLab.com</a>,
                <a href="https://gitlab.science.ru.nl/">Science GitLab</a>
                <div class="fragment fade-out" data-fragment-index="1"
                     style="text-align: center;">
                  <p>GitLab is technically superior,<br>
                  <span class="concept">but</span> all the cool kids hang out on GitHub.<br>
                  </p>
                  <p>&rarr; we will use GitHub for examples</p>
                </div>
              </li>
            </ul>

            <ul class="fragment" data-fragment-index="1" style="margin-top: 10px; margin-left: 10%;">
              <li>Choose a server: <a href="https://github.com/">GitHub</a>,
                <a href="https://about.gitlab.com/">GitLab.com</a>,
                <a href="https://gitlab.science.ru.nl/">Science GitLab</a></li>
              <li>Create a repository using web interface:
                <div style="text-align: center;" class="r-stack">
                  <img src="assets/img/github_click_on_new.png"
                       style="width: 80%; border: 4px solid #657b83; margin-top: 10px; margin-bottom: 0;"
                       class="fragment fade-in-then-out" data-fragment-index="1"></img>
                  <span class="fragment fade-out" data-fragment-index="3">
                    <img src="assets/img/github_choose_a_name.png"
                         style="width: 60%; border: 4px solid #657b83; margin-top: 10px;"
                         class="fragment fade-in"
                         data-fragment-index="2"></img>
                  </span>
                  <img src="assets/img/github_follow_instructions.png"
                       style="width: 85%; border: 4px solid #657b83; margin-top: 10px;"
                       class="fragment fade-in"
                       data-fragment-index="3"></img>
                </div>
              </li>
            </ul>
          </div>
        </section>

        <section data-background-image="assets/img/ru_logo_a4_imm_eng_1.png"
                 data-background-size="25%"
                 data-background-position="bottom right 10%">
          <h2>Example: following GitHub's instructions</h2>

          <pre style="font-size: 70%;"><code data-trim
                                             data-noescape
                                             data-line-numbers="1|2-3|4"
                                             class="shell">
              $ cd quantum_skyrmions/
              $ git init
              Initialized empty Git repository in .../quantum_skyrmions/.git/
              $ git remote add origin https://github.com/twesterhout/quantum_skyrmions.git
          </code></pre>
          <img src="assets/img/github_remote.png"
               style="width: 30%; border: 4px solid #657b83; padding: 5px; margin-top: 10px;"></img>
        </section>

        <section data-background-image="assets/img/ru_logo_a4_imm_eng_1.png"
                 data-background-size="25%"
                 data-background-position="bottom right 10%">
          <h2>Example: cloning a repository</h2>

          <p>What your collaborators will do after you have created a repository:</p>
          <pre style="font-size: 70%;"><code data-trim
                                             data-noescape
                                             data-line-numbers="1|2,5-10|11"
                                             class="shell">
              $ git clone https://github.com/twesterhout/quantum_skyrmions.git
              Cloning into 'quantum_skyrmions'...
              Username for 'https://github.com': <span style="font-style: italic">username</span>
              Password for 'https://<span style="font-style: italic">username</span>@github.com': <span style="font-style: italic">password</span>
              remote: Enumerating objects: 147, done.
              remote: Counting objects: 100% (147/147), done.
              remote: Compressing objects: 100% (119/119), done.
              remote: Total 147 (delta 30), reused 140 (delta 26), pack-reused 0
              Receiving objects: 100% (147/147), 2.46 MiB | 777.00 KiB/s, done.
              Resolving deltas: 100% (30/30), done.
              $ cd quantum_skyrmions/
          </code></pre>
        </section>

        <section data-background-image="assets/img/ru_logo_a4_imm_eng_1.png"
                 data-background-size="25%"
                 data-background-position="bottom right 10%">
          <h2 style="margin-top: 0; margin-bottom: 0;">Example: making changes to files</h2>

          <pre style="font-size: 70%; margin-top: 0; margin-bottom: 0;"><code
               data-trim data-noescape data-line-numbers="1|2-3|4|5|6,9-17"
               class="shell" style="max-height: 500px;">
              $ vi "Analysis/SimpleTests.wl" # Making the changes...
              $ WolframKernel -script Analysis/SimpleTests.wl # Testing...
              Hello world!
              $ git add Analysis/SimpleTests.wl # Track SimpleTests.wl
              $ git commit -m "Implement hello world" # Commit to changes
              $ git push origin main # Uploading to remote server...
              Username for 'https://github.com': <span style="font-style: italic;">username</span>
              Password for 'https://<span style="font-style: italic;">username</span>@github.com': <span style="font-style: italic;">password</span>
              Enumerating objects: 9, done.
              Counting objects: 100% (9/9), done.
              Delta compression using up to 8 threads
              Compressing objects: 100% (6/6), done.
              Writing objects: 100% (6/6), 496.66 KiB | 12.42 MiB/s, done.
              Total 6 (delta 2), reused 0 (delta 0), pack-reused 0
              remote: Resolving deltas: 100% (2/2), completed with 2 local objects.
              To https://github.com/twesterhout/quantum_skyrmions
                 bd922d6..817e53d  main -&gt; main
          </code></pre>
          <div class="fragment r-hstack" style="margin-top: 5px; align-items: flex-start;">
            <p style="margin-top: 0; margin-right: 3%;">Now you are safe:</p>
            <ul class="checklist" style="margin-top: 0;">
              <li class="pass">Code is backed up</li>
              <li class="pass">Trivial to revert to a previous state</li>
            </ul>
          <div>
        </section>

        <section data-background-image="assets/img/ru_logo_a4_imm_eng_1.png"
                 data-background-size="25%"
                 data-background-position="bottom right 10%">
          <h2>Example: updating</h2>

          <pre style="font-size: 70%; margin-top: 0; margin-bottom: 0;"><code
               data-trim data-noescape data-line-numbers="1|2,5-16"
               class="shell" style="max-height: 500px;">
              $ cd quantum_skyrmions/
              $ git pull origin main # fetch &amp; merge changes from remote
              Username for 'https://github.com': <span style="font-style: italic;">username</span>
              Password for 'https://<span style="font-style: italic;">username</span>@github.com': <span style="font-style: italic;">password</span>
              remote: Enumerating objects: 5, done.
              remote: Counting objects: 100% (5/5), done.
              remote: Compressing objects: 100% (1/1), done.
              remote: Total 3 (delta 2), reused 3 (delta 2), pack-reused 0
              Unpacking objects: 100% (3/3), 1.76 KiB | 451.00 KiB/s, done.
              From https://github.com/twesterhout/quantum_skyrmions
               * branch            main       -&gt; FETCH_HEAD
                 817e53d..88e8c26  main       -&gt; origin/main
              Updating 817e53d..88e8c26
              Fast-forward
               SimpleTests.wl | 139 ++++++++++++++++++++++++++++++++--------
               1 file changed, 114 insertions(+), 25 deletions(-)
          </code></pre>
        </section>

        <section data-background-image="assets/img/ru_logo_a4_imm_eng_1.png"
                 data-background-size="25%"
                 data-background-position="bottom right 10%">
          <h2>Git</h2>

          <ul>
            <li>Concepts (repository, commit, hash, branch, <span>remote</span>)
            </li>
            <li class="fragment">
              <code>git <a href="https://git-scm.com/docs/git-init">init</a></code> &mdash; create new local repository<br>
              <code>&nbsp;&nbsp;&nbsp; <a href="https://git-scm.com/docs/git-remote">remote add</a></code> &mdash; add new remote repository<br>
              <code>&nbsp;&nbsp;&nbsp; <a href="https://git-scm.com/docs/git-clone">clone</a></code> &mdash; clone an existing repository<br>
              <code>&nbsp;&nbsp;&nbsp; <a href="https://git-scm.com/docs/git-add">add</a></code> &mdash; add some changes to the next commit<br>
              <code>&nbsp;&nbsp;&nbsp; <a href="https://git-scm.com/docs/git-commit">commit</a></code> &mdash; commit changes<br>
              <code>&nbsp;&nbsp;&nbsp; <a href="https://git-scm.com/docs/git-push">push</a></code> &mdash; publish local changes on a remote<br>
              <code>&nbsp;&nbsp;&nbsp; <a href="https://git-scm.com/docs/git-pull">pull</a></code> &mdash; get all changes from remote to local repository<br>
              <code>&nbsp;&nbsp;&nbsp; <a href="https://git-scm.com/docs/git-status">status</a></code> &mdash; view changes in working directory<br>
            </li>
          </ul>

          <h3 class="fragment">
            <span style="font-weight: bold; text-decoration: underline;">Guideline:</span>
            have a repository for every project you work on
          </h3>
        </section>

        <section data-background-image="assets/img/ru_logo_a4_imm_eng_1.png"
                 data-background-size="25%"
                 data-background-position="bottom right 10%">
          <h2>What to do with data?</h2>

          <p class="concept">Git is not meant to be used with large files!</p>

          <div style="text-align: left; margin-left: 25%;">
            <p style="margin-bottom: 5px;">Solutions:</p>
            <ul style="padding-left: 20px;">
              <li>Git Large File Storage (LFS)</li>
              <li>Data Version Control (DVC)</li>
            </ul>
          </div>
        </section>

        <section data-background-image="assets/img/ru_logo_a4_imm_eng_1.png"
                 data-background-size="25%"
                 data-background-position="bottom right 10%">
          <h2>Git Large File Storage (LFS)</h2>

          <div style="width: 70%; margin-left: auto; margin-right: auto;">
            <blockquote style="width: 100%">
              Git LFS handles large files by storing references to the file in
              the repository, but not the actual file itself.
            </blockquote>
            <p style="font-size: 50%; text-align: right;">
              <span style="font-style: italic">Source:</span>
              <a href="https://docs.github.com/en/github/managing-large-files/about-git-large-file-storage">GitHub Docs</a>
            </p>
          </div>

          <ul style="width: 80%;">
            <li class="fragment">Git servers take care of storing the files;</li>
            <li class="fragment">
                Tell <a href="https://git-lfs.github.com/"><code>git-lfs</code></a> to track specific files:
                <pre style="font-size: 70%; margin-left: 0; margin-top: 5px; margin-bottom: 5px;"><code
                     data-trim data-noescape class="shell">
                    $ git lfs track "*.h5" # Track all HDF5 files
                    Adding path *.h5
                    $ git add "heisenberg_37.h5" # Work using standard git commands
                </code></pre>
            </li>
            <li class="fragment">
                Storage limits:
                <table style="margin-top: 5px; border: 3px solid #657b83;">
                  <tr>
                    <td>GitHub Free</td>
                    <td><code>&nbsp;2G</code></td>
                  </tr>
                  <tr>
                    <td>GitLab.com Free</td>
                    <td><code>10G</code></td>
                  </tr>
                  <tr>
                    <td>Science GitLab</td>
                    <td><code>10G</code> <span style="font-style: italic; color: #93a1a1;">(probably)</span></td>
                  </tr>
                </table>
            </li>
          </ul>
        </section>

        <section data-background-image="assets/img/ru_logo_a4_imm_eng_1.png"
                 data-background-size="25%"
                 data-background-position="bottom right 10%">
          <h2>Data Version Control (DVC)</h2>

          <div style="width: 70%; margin-left: auto; margin-right: auto;">
            <blockquote style="width: 100%">
              DVC is built to make ML models shareable and reproducible. It is designed to
              handle large files, data sets, machine learning models, and metrics as well as
              code.
            </blockquote>
            <p style="font-size: 50%; text-align: right;">
              <span style="font-style: italic; margin-right: 20px;">ML = Machine Learning,</span>
              <span style="font-style: italic">Source:</span>
              <a href="https://dvc.org/">DVC Homepage</a>
            </p>
          </div>

          <ul>
            <li class="fragment">
              Git-like workflow, e.g.
                <a href="https://dvc.org/doc/command-reference/add"><code>dvc add</code></a>,
                <a href="https://dvc.org/doc/command-reference/push"><code>dvc push</code></a>
                etc.
            </li>
            <li class="fragment">
              <span style="font-weight: bold;">You</span> choose where data is stored. Suggestion:<br>
              <code>&nbsp;&nbsp;if</code> you are broke (like me)<br>
              <code>&nbsp;&nbsp;&nbsp;&nbsp;then</code> <a href="https://www.surf.nl/en/surfdrive-store-and-share-your-files-securely-in-the-cloud">Surfdrive</a> (<code>500G</code> per RU employee)<br>
              <code>&nbsp;&nbsp;&nbsp;&nbsp;else</code> <a href="https://aws.amazon.com/s3/">Amazon S3</a> (easier to collaborate)
            </li>
          </ul>
        </section>

        <section data-background-image="assets/img/ru_logo_a4_imm_eng_1.png"
                 data-background-size="25%"
                 data-background-position="bottom right 10%">
          <h2>Recap</h2>

          <ul>
            <li><span class="concept">Have a repository for every project you work on!</span></li>
            <li>Git LFS for keeping track of <span style="font-style: italic">production</span> datasets<br>
                (i.e. data to reproduce your figures).
            </li>
            <li><span style="color: #93a1a1">(optional)</span> DVC for keeping track of "work-in-progress" data.</li>
          </ul>
          <p class="fragment concept">Questions?</p>
        </section>

        <section data-background-image="assets/img/ru_logo_a4_imm_eng_1.png"
                 data-background-size="25%"
                 data-background-position="bottom right 10%">
          <h2>Reproducibility</h2>

          <ul>
            <li class="fragment">Sharing your environment</li>
            <li class="fragment">Making your code portable</li>
          </ul>
        </section>

        <section data-background-image="assets/img/ru_logo_a4_imm_eng_1.png"
                 data-background-size="25%"
                 data-background-position="bottom right 10%">
          <h2>Sharing your environment: virtualization</h2>

          <div style="width: 75%; margin-left: auto; margin-right: auto;">
            <blockquote style="width: 100%;">
              <span class="concept">Virtualization</span> refers to the act of
              creating a virtual (rather than actual) version of something,
              including virtual computer hardware platforms, storage devices,
              and computer network resources.
            </blockquote>
            <p style="font-size: 55%; margin-top: 0; text-align: right;">
              <span style="font-style: italic">Source:</span>
              <a href=https://en.wikipedia.org/wiki/Virtualization/>Wikipedia</a>
            </p>
          </div>

          <div>
            <ul>
              <li>Virtual machines;</li>
              <li>Hardware drivers;</li>
              <li>etc.</li>
            </ul>
          </div>
        </section>

        <section data-background-image="assets/img/ru_logo_a4_imm_eng_1.png"
                 data-background-size="25%"
                 data-background-position="bottom right 10%">
          <h2>Virtualization: levels</h2>

          <ul>
            <li>Virtual machines (e.g. <a href="https://www.virtualbox.org/">VirtualBox</a>,
              <a href="https://docs.microsoft.com/en-us/windows/wsl/about">Windows Subsystem for Linux</a>):
              <ul class="checklist">
                <li class="pass">abstracts everything
                  <span style="text-decoration: underline;">including the kernel</span>;
                </li>
                <li class="fail">performance overhead;</li>
              </ul>
            </li>
            <li class="fragment">Containers (e.g. <a href="https://www.docker.com/">Docker</a>,
              <a href="https://sylabs.io/docs/">Singularity</a>):
              <ul class="checklist">
                <li class="pass">reuses the kernel, but abstracts everything else</li>
                <li class="pass">no performance overhead</li>
              </ul>
            </li>
            <li class="fragment">Virtual environments (e.g.
              <a href="https://docs.python.org/3/tutorial/venv.html"><code>venv</code></a>,
              <a href="https://docs.conda.io/en/latest/">Conda</a>):
              <ul class="checklist">
                <li class="meh">abstracts only certain applications</li>
                <li class="pass">no performance overhead</li>
              </ul>
            </li>
          </ul>
        </section>

        <section data-background-image="assets/img/ru_logo_a4_imm_eng_1.png"
                 data-background-size="25%"
                 data-background-position="bottom right 10%">
          <h2>Conda</h2>

          <div style="width: 75%; margin-left: auto; margin-right: auto;">
            <blockquote style="width: 100%;">
              Package, dependency and environment management for any language
              &mdash; Python, R, Ruby, Lua, Scala, Java, JavaScript, C/ C++,
              FORTRAN, and more.
            </blockquote>
            <p style="font-size: 55%; margin-top: 0; text-align: right;">
              <span style="font-style: italic">Source:</span>
              <a href="https://docs.conda.io/en/latest/">Conda documentation</a>
            </p>
          </div>

          <ul>
            <li><span class="concept">Packages</span> &mdash; programs, libraries, etc.</li>
            <li><span class="concept">Environments</span> consist of packages</li>
          </ul>
        </section>

        <section data-background-image="assets/img/ru_logo_a4_imm_eng_1.png"
                 data-background-size="25%"
                 data-background-position="bottom right 10%">
          <h2>Example: creating environments from files</h2>

          <div class="r-hstack">
            <pre style="font-size: 60%; margin-right: 0; width: 40%;"><code data-trim data-noescape class="shell">
            $ # Creating an environment...
            $ conda env create -f conda-devel.yml
            $ # Adding to git...
            $ git add conda-devel.yml
            $ git commit -m "Create environment"
            </code></pre>

            <div style="width: 55%;">
              <p style="text-align: left; margin-left: 25px; margin-top: 0; margin-bottom: 0; font-size: 80%;"><code>conda-devel.yml</code>:</p>
              <pre style="font-size: 50%; margin-top: 0;"><code data-trim data-noescape class="yaml">
                name: lattice_symmetries_devel
                channels:
                  - defaults
                  - weinbe58 # for QuSpin
                dependencies:
                  - python
                  - pip:
                    - black
                    - neovim
                    - loguru
                  - numpy
                  - scipy
                  # Stuff to compile the package locally
                  - gcc_linux-64
                  - gxx_linux-64
                  - cmake
                  - ninja
                  # For benchmarks and testing
                  - numba ==0.48 # QuSpin doesn't work with the latest version
                  - omp # Get multi-threading support for QuSpin
                  - quspin
                  ...
              </code></pre>
            </div>
          </div>
        </section>

        <section data-background-image="assets/img/ru_logo_a4_imm_eng_1.png"
                 data-background-size="25%"
                 data-background-position="bottom right 10%">
          <h2>Conda</h2>

          <h3>
            <span style="font-weight: bold; text-decoration: underline;">Guideline:</span>
            have a Conda environment for every project you work on
          </h3>

          <div style="text-align: left; margin-top: 10%; margin-left: 5%;">
            <p class="fragment" data-fragment-index="1">If you already know what Conda is:</p>
            <ul style="margin-left: 5%;">
              <li class="fragment concept" data-fragment-index="1">
                Do not use <code>base</code> environment!</li>
              <li class="fragment concept" data-fragment-index="2">
                Do not use <code>conda install</code> (except for testing)!</li>
            </ul>
          </div>
        </section>

        <section data-background-image="assets/img/ru_logo_a4_imm_eng_1.png"
                 data-background-size="25%"
                 data-background-position="bottom right 10%">
          <h2>Singularity</h2>

          <div style="width: 80%; margin-left: auto; margin-right: auto;">
            <blockquote style="width: 100%;">
              Singularity containers can be built to include all of the
              programs, libraries, data and scripts such that an entire
              demonstration can be contained and either archived or distributed
              for others to replicate no matter what version of Linux they are
              presently running.
            </blockquote>
            <p style="font-size: 55%; margin-top: 0; text-align: right;">
              <span style="font-style: italic">Source:</span>
              <a href="https://sylabs.io/guides/3.7/user-guide/introduction.html">Singularity User Guide</a>
            </p>

            <ul>
              <li><span class="concept">Container</span> is a single file;</li>
              <li>Can easily run Docker containers<br>
                (i.e.  <a href="https://cloud.sylabs.io/library">Container Library</a> +
                <a href="https://hub.docker.com/">Docker Hub</a>)
              </li>
              <li>Imagine having admin rights on the cluster &#x1F60F;</li>
            </ul>
          </div>
        </section>

        <section data-background-image="assets/img/ru_logo_a4_imm_eng_1.png"
                 data-background-size="25%"
                 data-background-position="bottom right 10%">
          <h2 style="margin-bottom: 0;">Example: creating a container</h2>

          <div class="r-hstack">
            <div style="width: 45%; margin-right: 0;">
              <pre style="font-size: 60%;"><code data-trim data-noescape class="shell">
              $ # no GPU locally...
              $ nvcc hello.cu -o hello
              bash: nvcc: command not found
              $ # Singularity to the rescue!
              $ singularity build hello.sif Singularity
              INFO:    Starting build...
              INFO:    Running setup scriptlet
              + mkdir -p /workdir
              INFO:    Copying hello.cu to /workdir/
              INFO:    Running post scriptlet
              + /bin/bash /.post.script
              INFO:    Adding runscript
              INFO:    Creating SIF file...
              INFO:    Build complete: hello.sif
              </code></pre>
            </div>

            <div style="width: 55%;">
              <p style="text-align: left; margin-left: 25px; margin-top: 0; margin-bottom: 0; font-size: 75%;"><code>hello.cu</code>:</p>
              <pre style="font-size: 50%; margin-top: 0; margin-bottom: 0;"><code data-trim data-noescape class="cuda">
              __global__ void cuda_hello() {
                  printf("Hello World from GPU!\n");
              }

              int main() {
                  cuda_hello&lt;&lt;&lt;1, 1&gt;&gt;&gt;();
                  return 0;
              }
              </code></pre>

              <p style="text-align: left; margin-left: 25px; margin-top: 0; margin-bottom: 0; font-size: 75%;"><code>Singularity</code>:</p>
              <pre style="font-size: 50%; margin-top: 0;"><code data-trim data-noescape class="plaintext">
                Bootstrap: docker
                From: nvidia/cuda:11.0-devel-ubuntu20.04

                %setup
                    mkdir -p ${SINGULARITY_ROOTFS}/workdir

                %files
                    hello.cu /workdir/

                %post
                    cd /workdir
                    nvcc hello.cu -o hello

                %runscript
                    /workdir/hello
              </code></pre>
            </div>
          </div>
          <p style="text-align: left; margin-left: 5%; font-size: 90%;">
            <span class="concept">Disclaimer:</span> this is an advanced example</p>
        </section>

        <section data-background-image="assets/img/ru_logo_a4_imm_eng_1.png"
                 data-background-size="25%"
                 data-background-position="bottom right 10%">
          <h2>Reproducibility</h2>

          <ul>
            <li>Sharing your environment (Conda &amp; Singularity).<br>
              <span class="concept" style="margin-left: 24px;">Questions?</p>
            </li>
            <li class="fragment">Making your code portable:<br>
              <span style="margin-left: 20px;">&rarr; Static executables<br></span>
              <span style="margin-left: 20px;">&rarr; AppImages<br></span>
            </li>
          </ul>
        </section>

        <section data-background-image="assets/img/ru_logo_a4_imm_eng_1.png"
                 data-background-size="25%"
                 data-background-position="bottom right 10%">
          <h2>Static executables</h2>

          <div class="r-hstack">
            <div style="width: 60%; margin-right: 0;">
              <pre style="font-size: 55%;"><code data-trim data-noescape
                data-line-numbers="1-5|6-10|11-13|14-17|18-21" class="shell"
                style="max-height: 500px;">
              $ # Compiling locally...
              $ g++-10 -std=c++20 thread.cpp -o thread -lpthread
              $ # Works locally
              $ ./thread
              Stopping...
              $ # And on lilo6
              $ scp thread lilo.science.ru.nl:
              $ ./thread
              $ ssh lilo6.science.ru.nl ./thread
              Stopping...
              $ # But breaks on lilo5
              $ ssh lilo5.science.ru.nl ./thread
              [...] version `GLIBCXX_3.4.22' not found [...]
              $ # Compile statically!
              $ g++-10 -std=c++20 thread.cpp -o thread \
                  -static -static-libgcc -static-libstdc++ \
                  -Wl,--whole-archive -lpthread -Wl,--no-whole-archive
              $ # Now works on lilo5 as well!
              $ scp thread lilo.science.ru.nl:
              $ ssh lilo5.science.ru.nl ./thread
              Stopping...
              </code></pre>
            </div>

            <div style="width: 40%;">
              <p style="text-align: left; margin-left: 25px; margin-top: 0; margin-bottom: 0; font-size: 75%;"><code>thread.cpp</code>:</p>
              <pre style="font-size: 50%; margin-top: 0;"><code data-trim data-noescape class="cpp">
              #include &lt;chrono&gt;
              #include &lt;cstdio&gt;
              #include &lt;thread&gt;

              auto main() -&gt; int {
                using namespace std::chrono_literals;
                // A sleepy worker thread
                auto sleepy_worker = std::jthread{
                  [](std::stop_token stoken) {
                    for (;;) {
                      std::this_thread::sleep_for(100ms);
                      if (stoken.stop_requested()) {
                        std::printf("Stopping...\n");
                        return;
                      }
                    }
                }};
                sleepy_worker.request_stop();
                sleepy_worker.join();
              }
              </code></pre>
            </div>
          </div>

          <div style="font-size: 55%; text-align: left; margin-left: 5%;">
          <p class="concept" style="margin-bottom: 0;">More info:</p>
          <ul>
            <li><a href="https://ro-che.info/articles/2016-09-09-static-binaries-scientific-computing">A case for static linking in scientific computing</a></li>
            <li><a href="https://stackoverflow.com/a/2649430">Difference between static and shared libraries</a></li>
            <li><a href="https://gcc.gnu.org/onlinedocs/gcc-10.2.0/gcc/Link-Options.html#Link-Options">GCC link options</a> (e.g. <code>-static</code>)</li>
          </ul>
          </div>
        </section>

        <section data-background-image="assets/img/ru_logo_a4_imm_eng_1.png"
                 data-background-size="25%"
                 data-background-position="bottom right 10%">
          <h2>AppImage</h2>
          <h3>Linux apps that run anywhere</h3>

          <div style="width: 75%; margin-left: auto; margin-right: auto;">
            <blockquote style="width: 100%;">
              Download an application, make it executable, and run! No need to
              install. No system libraries or system preferences are altered.
            </blockquote>
            <p style="font-size: 55%; margin-top: 0; text-align: right;">
              <span style="font-style: italic">Source:</span>
              <a href="https://appimage.org/">AppImage Homepage</a>
            </p>
          </div>

          <ul>
            <li></li>
          </ul>
        </section>


      </div>
    </div>

    <script src="dist/reveal.js"></script>
    <script src="plugin/math/math.js"></script>
    <script src="plugin/notes/notes.js"></script>
    <script src="plugin/markdown/markdown.js"></script>
    <script src="plugin/highlight/highlight.js"></script>
    <script>
      // More info about initialization & config:
      // - https://revealjs.com/initialization/
      // - https://revealjs.com/config/
      Reveal.initialize({
        slideNumber: true,
        hash: true,
        center: true,
        transition: 'none',
        controls: false,
        controlsTutorial: false,
        progress: false,

        // Learn about plugins: https://revealjs.com/plugins/
        plugins: [ RevealMath, RevealMarkdown, RevealHighlight, RevealNotes ]
      });
    </script>
  </body>
</html>
